<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Upload Files</title>
</head>

<body>
	<h2>Lynx Client TEst</h2>
	<input id="host" placeholder="ip/host:port" />
	<br>Select file
	<input type="file" id="filename" />
	<br>
	<input type="button" value="Connect" onclick="connectChatServer()" />
	<br>
	<input type="button" value="transfer file to device" onclick="sendFile()" />
	<img src="" id="AAA" />
	<script>
		var ws;

		if (localStorage.getItem("memorised_host")) document.getElementById("host").value = localStorage.getItem("memorised_host");

		function connectChatServer() {
			ws = new WebSocket(`ws://${document.getElementById("host").value}`);
			localStorage.setItem("memorised_host", document.getElementById("host").value);
			ws.binaryType = "arraybuffer";
			ws.onopen = function () {
				alert("Connected.");
			};

			setInterval(() => {
				ws.send("frame_please");
			}, 20);

			ws.onmessage = function (evt) {
				document.getElementById("AAA").src = "data:image/png;base64," + evt.data;
			};

			ws.onclose = function () {
				alert("Connection is closed...");
			};

			ws.onerror = function (e) {
				alert(e.msg);
			};
		}

		function sendFile() {
			var file = document.getElementById('filename').files[0];
			var reader = new FileReader();
			var rawData = new ArrayBuffer();

			reader.loadend = function () {

			}

			reader.onload = function (e) {
				rawData = e.target.result;
				ws.send(rawData);
				alert("the File has been transferred.")
			}

			reader.readAsArrayBuffer(file);
		}
	</script>
</body>

</html>