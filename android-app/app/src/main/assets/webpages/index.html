<!DOCTYPE html>
<html>
	<head>
		<title>Lynx Dev</title>
		<link href="w3.css" rel="stylesheet" />
		<style>
			body { font-family: "Roboto", sans-serif !important; }
		</style>
		<meta charset="utf8" />
	</head>

	<body class="animate-opacity">
		<div class="padding">
			<h2>Lynx Testing</h2>
			<p>Using: Java Websocket Client Backend</p>

			<b>Lynx Server:</b>
			<br>
			<input class="padding margin-top margin-bottom" id="host" style="width: calc(100% - 98px);" value="ws://192.168.1.1:8080" placeholder="ws://ip or hostname:port" />
			<button onclick="connectWS();" class="padding">Connect</button>

			<br>
			<b>Debug Commands</b>
			<div class="light-grey padding margin-top margin-bottom">
				<button onclick="Android.startBackgroundService();">Start BG Service</button>
				<button onclick="Android.qrCodeReader();">QR Code Reader</button>
				<button onclick="sendWS();">Send WS Text</button>
				<a href="ouch.html">Page</a>
			</div>
			
			<b>Log</b>
			<pre class="padding margin-top margin-bottom light-grey" style="height: calc(100vh - 370px); overflow: scroll;" id="log"></pre class="padding margin-top margin-bottom">
		</div>

		<script>
			let state = {};
			const hostInput = document.getElementById("host"); hostInput.focus();
			const log = document.getElementById("log");
			let uuid;

			function connectWS() {
				let a = Android.connectWS(hostInput.value);
				log.innerText += "\n" + a;
			}

			function sendWS() {
				let a = Android.sendWS(JSON.stringify({
					type: "initial_auth",
					data: {
						token: uuid
					}
				}));
				log.innerText += "\n" + a;
			}
			
			function htmlLog(a) {
				log.innerText += "\n" + a;
			}

			function updateIP(qrInfo) {
				try { qrInfo = JSON.parse(qrInfo); }
				catch (e) {
					log.innerText += "\nError in QR code JSON";
					return;
				}

				log.innerText += "\n" + JSON.stringify(qrInfo, null, 2);
				hostInput.value = "ws://" + qrInfo.ip + ":57531";
				uuid = qrInfo.connectionToken;
			}
		</script>
	</body>
</html>